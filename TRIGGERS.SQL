----------------------------------------------------
CREATE OR REPLACE TRIGGER INSERT_EVENT
BEFORE INSERT OR UPDATE ON EVENTO
FOR EACH ROW
DECLARE

JOURNEY_END JORNADA.FECHA_FIN%TYPE;
JOURNEY_PHASE JORNADA.ID_FASE%TYPE;

BEGIN
SELECT JORNADA.FECHA_FIN, JORNADA.ID_FASE
INTO JOURNEY_END , JOURNEY_PHASE
FROM EVENTO
INNER JOIN JORNADA
ON EVENTO.ID_JORNADA=JORNADA.ID_JORNADA;


IF (:NEW.FECHA < SYSDATE)
then RAISE_APPLICATION_ERROR(-20001, 'ERROR FECHA');
END IF;

IF (:NEW.FECHA > JOURNEY_END)
then RAISE_APPLICATION_ERROR(-20001, 'ERROR JORNADA');
END IF;

IF ((:OLD.MARCADOR_LOCAL != NULL) AND (:OLD.MARCADOR_VISITA != NULL))
THEN  RAISE_APPLICATION_ERROR(-20001, 'ERROR RESULTADO');
END IF;

IF (JOURNEY_PHASE = 1)
THEN  RAISE_APPLICATION_ERROR(-20001, 'ERROR JORNADA ACTIVA');
END IF;

END;
--------------------------------------------------------------